<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>androidNDKStudy by bostontrader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">androidNDKStudy</h1>
      <h2 class="project-tagline">A study re: how to make Android Studio, the experimental Gradle plugin, the NDK, JNI, and a mixture of Java, C, and C++, play nice and do tricks. </h2>
      <a href="https://github.com/bostontrader/androidNDKStudy" class="btn">View on GitHub</a>
      <a href="https://github.com/bostontrader/androidNDKStudy/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/bostontrader/androidNDKStudy/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="how-to-get-started-with-android-studio-the-experimental-gradle-plugin-the-ndk-jni-c-and-c" class="anchor" href="#how-to-get-started-with-android-studio-the-experimental-gradle-plugin-the-ndk-jni-c-and-c" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to get started with Android Studio, the Experimental Gradle plugin, the NDK, JNI, C, and C++</h1>

<p>The vast majority of Android development is done using Java.  However, there are times when
we want to access "native" code from Java.  For example, maybe you have some C or C++ code
that you want to access from your Java code.  Whether this is a good idea or not is a separate
issue.  Assuming that you've c/o/n/s/u/l/t/e/d/ /y/o/u/r/ /8/-/b/a/l/l/ made your informed decision and have
decided to do it, let me share some tips that I found useful.</p>

<p>You'll be happy to know that doing this with Android Studio and Gradle is very feasible.
As of the time of writing (Aug 2015), this apparently is a recent development and almost all other
documentation that I have found was for doing this with Eclipse, the command line, or doing various
contortions to make it work with Android Studio and Gradle.  Fortunately none of that's necessary.</p>

<p>The key to success in this endeavor, IMHO, is to figure out the <a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental">experimental Gradle plugin</a>.
You'll need to also study the <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html">Java Native Interface (JNI)</a> and the
<a href="http://developer.android.com/ndk/guides/index.html">Android Native Development Kit (NDK)</a>.
JNI is Java's spec for how Java should interact
with not-Java and the NDK is the kit you need to connect Android/Java to JNI. The NDK is easy and
straight-forward to download and install and there are no hidden surprises here.  Start with README.txt
and nose around in /docs and see what you find.</p>

<p>One pleasant surprise is that the NDK is fully equipped with its own build tools.  I haven't
yet spelunked into the murky depths of this, but something in there can clearly compile
C and C++ code and build the relevant .so files, even on WinXP.</p>

<p>Another pleasant surpise is that the Gradle/NDK is very good at figuring out what to do,
by default, without a lot of hand-holding.  This illustrates the ole convention-over-configuration
principle.  So Gradle/NDK is able to find our source files and lots of header stuff
and figure out what to do without whatever outputs it creates, without me having to micro-manage.
Just sit back and enjoy a cold one while Skynet takes over.  No more futzing with cranky software.</p>

<p>But wait... there's more!</p>

<p>Tips from Tom!</p>

<p>One of the things that really bedeviled me in figuring this out was getting the naming
 right for C and C++ functions.  For example, if you declare native String foo, in Java class
 Bar, you will need a suitably named function <em>somewhere</em> in your collection of C/C++ source files.
 The tedious rules for what exactly to name this include the Java package and class name of
 the Java doing the calling.  This in and of itself is not so difficult.  The problem is if
 you don't get this right, the exception messages are not helpful.  So the tip is...</p>

<p>Declare your native method first, in your Java source, and let the Android Studio tell you
 that it can't find the expected function definition.  When doing so, AS will tell you
 specifically what it's looking for!</p>

<p>Another thing... There's something odd going on with Android.mk and
 Application.mk.  When modifying them and rebuilding the project, I cannot detect
   any effect.  I have therefore deleted them and everything still runs just fine.
    However, there may be some is-it-really-getting-cleaned-and-properly-rebuilt
    effect at work, that I have not yet determined.</p>

<p>Finally, be sure to examine the extern "C" { JNIEXPORT ... JNICALL stuff in the
cpp file.  We need it.  If it's not there, your Java cannot find the methods.</p>

<p>For this effort I'm using Android Studio 1.3.2, NDK r10e,
com.android.tools.build:gradle-experimental:0.2.0, on WinXP.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/bostontrader/androidNDKStudy">androidNDKStudy</a> is maintained by <a href="https://github.com/bostontrader">bostontrader</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
